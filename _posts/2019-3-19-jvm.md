---
layout: default

title: jvm

---

## jvm

![](https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/jvm.jpg)

![](https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/jvm2.jpg)

### 内存模型
![](https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/jvm.png)
#### 程序计数器（线程私有）

#### 虚拟机栈（线程私有）

#### 本地方法栈

#### java堆（线程共有）
存放对象实例，垃圾收集器管理的区域

#### 方法区（线程共有）
虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码

存放类信息（类名、访问修饰符、常量池、字段描述、方法描述）
#### 运行时常量池（方法区一部分）

#### 直接内存

### 对象的内存布局
对象头

实例数据

对齐填充

### 垃圾回收
引用计数（java没用）

可达性分析算法(java使用)
#### 垃圾回收算法
标记-清除算法

复制算法（现在商业虚拟机用该算法回收新生代）

标记-整理算法（现在商业虚拟机用该算法回收老生代）

分代收集算法（现在商业虚拟机采用以上两个算法）

### 虚拟机性能监控
jps：虚拟机进程状况工具

jstat：虚拟机统计信息监视工具

jinfo：java配置信息工具

jmap：java内存映射工具

jhat：堆转储快照分析工具

jstack：堆栈跟踪工具

-vmargs 说明后面是VM的参数，所以后面的其实都是JVM的参数了

-Xms128m JVM初始分配的堆内存，默认是物理内存的1/64

-Xmx512m JVM最大允许分配的堆内存，默认是物理内存的1/4

-XX:PermSize=64M JVM初始分配的非堆内存，默认是物理内存的1/64

-XX:MaxPermSize=128M JVM最大允许分配的非堆内存，默认是物理内存的1/4





### Class
常量池：Class文件开头有常量池入口，主要存放字面量，符号引用（类和接口、字段、方法的名字和描述符）

虚拟机加载class文件的时候进行动态链接，所以class文件不会保存各个方法、字段的最终内存布局信息


字段表、方法表有指向常量池的指针，用常量池来描述。



### java执行引擎工作原理：方法调用
jvm用c/c++编写，可以直接调用机器代码

### 字节码
magicNumber

version

常量池constant_pool_count

constant_pool[]

Access_flag

this_class

super_class

Interfaces

interfaces_count

interfaces[]

fields_count

fields[]

methods_count

void <clinit> 类的初始化都在该函数里，包括静态变量和static{}包围的程序的初始化

method[]

attributes_count

attributes[]

### oop-klass
klass保存类元信息，保存在perm永久区，oop保存类实例，保存在heap堆区

### 类加载
加载

验证

文件格式、元数据验证、字节码验证、符号引用验证

准备

解析

初始化