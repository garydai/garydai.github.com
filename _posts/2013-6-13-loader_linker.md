---
layout: default
title: 链接器和加载器

---

##链接器和加载器   

###链接器   
链接各个模块至同一个进程空间。   
整合各个模块的段,确定段在地址空间的基地址。      
根据重定位表，重定位符号。    
####重定位
把各个模块中的符号地址重定位在进程空间里。   
#####重定位表
记录需要重定位的符号，和符号所在段及位置。   
#####符号表
记录目标文件里的符号名和对应符号在目标文件所属段中的地址    

######定义在本目标文件的全局符号(变量、函数)    
######引用外目标文件的全局符号    
######段名(与链接无关)    
######静态局部符号(与链接无关)
######行号信息(与链接无关)    
**强符号**：函数和初始化的全局变量      
**弱符号**：未初始化的全局变量     
**强引用**：   
**强符号**：    
####静态链接
链接目标文件、重定位符号，生成可执行文件。    
符号重定位在链接时确定。   
####动态链接
链接、重定位过程推迟到运行时。较之静态链接使用共享模块，节省内存，易于维护升级程序。            
#####共享模块(dll,so)
模块内的符号引用采用相对地址。   
模块间的符号引用,因为外部符号地址在装载时候才能确定，查询全局偏移表(GOT)得到外部符号地址，令指令代码与地址无关，该表存在于数据段，装载时，填入外部符号的地址。一般动态库的代码段只有一份，数据段由每个调用模块各自维护一份。   
令指令代码地址无关，可以使指令代码保持一份，节省内存；如果代码不是地址无关，则每个进程要维护一份副本，装载时重定位。使用-fPIC(linux)命令编译文件成地址无关共享模块。
#####动态链接器
加载可执行文件后，然后加载动态链接器，运行动态链接器，初始化动态链接的相关工作，最后才运行可执行文件。    
#####链接步骤
1启动动态链接器    
2装载共享对象           
3重定位和初始化(初始化执行.init段中的代码)             
            
###加载器   
操作系统创建进程，加载可执行文件，然后运行。具体做了以下三件事：   
1创建独立虚拟地址空间(创建虚拟地址与内存的映射数据结构)    
2读取可执行文件程序头，创建虚拟地址与可执行文件的映射数据结构。(可执行或目标文件的段信息有指定对应的虚拟基地址。)     
3将CPU指令寄存器设置成可执行文件入口，启动运行。   

###reference
链接器和加载器
程序员的自我修养-链接、装载与库





###question
如何知道引用的符号是共享模块还是其他目标文件？   