---

layout: default

title:  tomcat

---

## tomcat原理

### 解析webapps所有war包
解压war包，导入class

读取WEB-INF文件夹里xml配置（或注解（springboot））

类加载servert class

### socket网络编程
一个线程监听连接，另外一个线程处理请求

### connector组件
连接器，监听接口

接受连接请求，分配线程让container来处理这个请求。

![](https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/connector.jpeg)

protocol 监听的协议，默认是http/1.1

port 指定服务器端要创建的端口号

minThread服务器启动时创建的处理请求的线程数

maxThread最大可以创建的处理请求的线程数

enableLookups如果为true，则可以通过调用request.getRemoteHost()进行DNS查询来得到远程客户端的实际主机名，若为false则不进行DNS查询，而是返回其ip地址

redirectPort指定服务器正在处理http请求时收到了一个SSL传输请求后重定向的端口号

acceptCount指定当所有可以使用的处理请求的线程数都被使用时，可以放到处理队列中的请求数，超过这个数的请求将不予处理

connectionTimeout指定超时的时间数(以毫秒为单位)

SSLEnabled 是否开启 sll 验证，在Https 访问时需要开启。


#### endpoint
默认NioEndpoint，监听端口

生产者，消费者模式

Socket acceptor thread

Socket poller thread

Woker threads pool
#### 

### service组件

### container组件
通用容器，包括以下容器
#### engine
servlet引擎（责任链模式）
#### host
主机
#### context
webapp
#### wrapper
Servlet

### executor
线程池

#### processor

#### protocol

### 启动
#### lifecycle生命周期
#### 初始化
#### 启动
catalina -> server -> (service1 service2 ...)

service -> (engine connector1 connector2 ...)

engine -> host -> context -> wrapper

### 三个类加载器
Common ClassLoader

Catalina ClassLoader

Shared ClassLoader

### io模型
#### nio
一个acceptor线程

两个Poller多路复用线程，调用selector.select(timeout)函数


![](https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/tomcat-engine.jpeg)

![](https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/tomcat-context.jpeg)

![](https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/tomcat.png)

![](https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/tomcat2.png)