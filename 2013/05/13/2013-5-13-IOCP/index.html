<!DOCTYPE html>


  <html class="light page-default">


<head>
  <meta charset="utf-8">
  
  <title>IOCP | Hexo</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="后端、技术、博客、架构、全栈" />
  

  <meta name="description" content="IOCP I&#x2F;O完成端口使用线程池处理异步I&#x2F;O请求的机制 I&#x2F;O模型-同步&#x2F;异步,阻塞&#x2F;非阻塞阻塞会挂起线程   同步表示A完成后才能执行B,两者有依赖关系 异步表示A&#x2F;B可以同时进行,两者没有联系   同步I&#x2F;OI&#x2F;O操作一般有两个不同的阶段：   1.等待数据数据到达网络，并拷贝到内核的缓冲区(等待数据准备好)。    2.把内核缓冲区的数据拷贝到应用程序缓冲区。线程只要阻塞在以上任意一个阶">
<meta property="og:type" content="article">
<meta property="og:title" content="IOCP">
<meta property="og:url" content="http://yoursite.com/2013/05/13/2013-5-13-IOCP/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="IOCP I&#x2F;O完成端口使用线程池处理异步I&#x2F;O请求的机制 I&#x2F;O模型-同步&#x2F;异步,阻塞&#x2F;非阻塞阻塞会挂起线程   同步表示A完成后才能执行B,两者有依赖关系 异步表示A&#x2F;B可以同时进行,两者没有联系   同步I&#x2F;OI&#x2F;O操作一般有两个不同的阶段：   1.等待数据数据到达网络，并拷贝到内核的缓冲区(等待数据准备好)。    2.把内核缓冲区的数据拷贝到应用程序缓冲区。线程只要阻塞在以上任意一个阶">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/blockiomodel.JPG">
<meta property="og:image" content="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/nonblockingiomodel.JPG">
<meta property="og:image" content="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/iomultiplexingmodel.JPG">
<meta property="og:image" content="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/singledriveniomodel.JPG">
<meta property="og:image" content="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/AsynchronousIOModel.JPG">
<meta property="article:published_time" content="2013-05-12T16:00:00.000Z">
<meta property="article:modified_time" content="2020-01-06T07:17:32.406Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/blockiomodel.JPG">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    
<link rel="stylesheet" href="/css/personal-style.css">

  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?65e0b4df283d78e15f8c78f238ec9593";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

<meta name="generator" content="Hexo 4.2.0"></head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">Posts List</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#IOCP-I-O完成端口"><span class="toc-text">IOCP I&#x2F;O完成端口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#I-O模型-同步-异步-阻塞-非阻塞"><span class="toc-text">I&#x2F;O模型-同步&#x2F;异步,阻塞&#x2F;非阻塞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#同步I-O"><span class="toc-text">同步I&#x2F;O</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#异步I-O"><span class="toc-text">异步I&#x2F;O</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#windows-重叠I-O"><span class="toc-text">windows 重叠I&#x2F;O</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOCP"><span class="toc-text">IOCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IOCP实现"><span class="toc-text">IOCP实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reference"><span class="toc-text">reference:</span></a></li></ol></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="default-2013-5-13-IOCP" class="article article-type-default" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">IOCP</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2013.05.13</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>John Doe</span>
        </span>
      

      


      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="IOCP-I-O完成端口"><a href="#IOCP-I-O完成端口" class="headerlink" title="IOCP I/O完成端口"></a>IOCP I/O完成端口</h2><p>使用线程池处理异步I/O请求的机制</p>
<h3 id="I-O模型-同步-异步-阻塞-非阻塞"><a href="#I-O模型-同步-异步-阻塞-非阻塞" class="headerlink" title="I/O模型-同步/异步,阻塞/非阻塞"></a>I/O模型-同步/异步,阻塞/非阻塞</h3><p>阻塞会挂起线程  </p>
<p>同步表示A完成后才能执行B,两者有依赖关系</p>
<p>异步表示A/B可以同时进行,两者没有联系  </p>
<h4 id="同步I-O"><a href="#同步I-O" class="headerlink" title="同步I/O"></a>同步I/O</h4><p>I/O操作一般有两个不同的阶段：  </p>
<p>1.等待数据数据到达网络，并拷贝到内核的缓冲区(等待数据准备好)。   </p>
<p>2.把内核缓冲区的数据拷贝到应用程序缓冲区。<br><strong>线程只要阻塞在以上任意一个阶段都称为同步I/O</strong><br>阻塞I/O  </p>
<p><img src="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/blockiomodel.JPG" alt="">  </p>
<p>非阻塞I/0<br><img src="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/nonblockingiomodel.JPG" alt="">  </p>
<p>I/O复用(select、poll)<br><img src="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/iomultiplexingmodel.JPG" alt="">  </p>
<p>信号驱动I/O<br><img src="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/singledriveniomodel.JPG" alt="">  </p>
<h4 id="异步I-O"><a href="#异步I-O" class="headerlink" title="异步I/O"></a>异步I/O</h4><p>线程不会阻塞在I/O两个阶段<br>异步i/O<br><img src="https://github.com/garydai/garydai.github.com/raw/master/_posts/pic/AsynchronousIOModel.JPG" alt=""><br>(boost::asio实现的应该是异步I/0，数据拷贝到应用程序缓冲区的时候才用回调函数通知应用程序)  </p>
<h3 id="windows-重叠I-O"><a href="#windows-重叠I-O" class="headerlink" title="windows 重叠I/O"></a>windows 重叠I/O</h3><p>事件方式：每一个socket操作(接收或发送数据等IO操作)关联一个重叠结构，一个重叠结构关联一个事件，所以有多少个socket操作就应该有多少个WSAOVERLAPPED结构，有多少个WSAOVERLAPPED结构就应该有多少个WSAEVENT事件  </p>
<p>完成例程：在重叠结构上关联一个回调函数,数据到达应用程序缓冲后系统调用该回调函数</p>
<p>完成端口(IOCP):事件方式和完成例程都会阻塞工作线程等待事件返回,而完成端口则是异步I/O,利用系统内核进行I/O调度.应用程序请求I/O操作,内核完成该操作以后,把完成的消息放入完成端口里,应用程序轮询该完成端口就知道I/O操作是否已经完成.  </p>
<h3 id="IOCP"><a href="#IOCP" class="headerlink" title="IOCP"></a>IOCP</h3><h4 id="IOCP实现"><a href="#IOCP实现" class="headerlink" title="IOCP实现"></a>IOCP实现</h4><ol>
<li><p>创建完成端口CreateIoCompletionPort  </p>
</li>
<li><p>创建多个工作线程</p>
</li>
<li><p>创建监听套结字,并绑定到完成端口</p>
</li>
<li><p>投递acceptex请求</p>
</li>
<li><p>工作线程GetQueuedCompletionStatus,等待完成端口上的各I/O操作完成的消息.</p>
</li>
<li><p>如果accept完成,创建连接套结字,绑定连接套结字到完成端口,并投递相关I/O操作,继续投递acceptex请求</p>
</li>
<li><p>如果非accept请求完成,处理相关缓冲,继续投递相关I/O操作</p>
</li>
<li><p>6-7循环  </p>
<h4 id="reference"><a href="#reference" class="headerlink" title="reference:"></a>reference:</h4><p><a href="http://blog.csdn.net/piggyxp/article/details/6922277" target="_blank" rel="noopener">http://blog.csdn.net/piggyxp/article/details/6922277</a></p>
</li>
</ol>

    
  </div>

</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2013/05/10/2013-5-10-unicode-utf-8/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2013/05/16/2013-5-16-todo/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">Close</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-default">
    

    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
